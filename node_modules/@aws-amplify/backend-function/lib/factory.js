import { functionOutputKey, } from '@aws-amplify/backend-output-schemas';
import { AttributionMetadataStorage } from '@aws-amplify/backend-output-storage';
import { AmplifyUserError, CallerDirectoryExtractor, TagName, } from '@aws-amplify/platform-core';
import { Duration, Size, Stack, Tags } from 'aws-cdk-lib';
import { Rule } from 'aws-cdk-lib/aws-events';
import * as targets from 'aws-cdk-lib/aws-events-targets';
import { Architecture, LayerVersion, Runtime, } from 'aws-cdk-lib/aws-lambda';
import { NodejsFunction, OutputFormat } from 'aws-cdk-lib/aws-lambda-nodejs';
import { Construct } from 'constructs';
import { readFileSync } from 'fs';
import { createRequire } from 'module';
import { fileURLToPath } from 'node:url';
import { EOL } from 'os';
import * as path from 'path';
import { FunctionEnvironmentTranslator } from './function_env_translator.js';
import { FunctionEnvironmentTypeGenerator } from './function_env_type_generator.js';
import { FunctionLayerArnParser } from './layer_parser.js';
import { convertLoggingOptionsToCDK } from './logging_options_parser.js';
import { convertFunctionSchedulesToRuleSchedules } from './schedule_parser.js';
const functionStackType = 'function-Lambda';
/**
 * Entry point for defining a function in the Amplify ecosystem
 */
export const defineFunction = (props = {}) => new FunctionFactory(props, new Error().stack);
/**
 * Create Lambda functions in the context of an Amplify backend definition
 */
class FunctionFactory {
    props;
    callerStack;
    generator;
    /**
     * Create a new AmplifyFunctionFactory
     */
    constructor(props, callerStack) {
        this.props = props;
        this.callerStack = callerStack;
    }
    /**
     * Creates an instance of AmplifyFunction within the provided Amplify context
     */
    getInstance = ({ constructContainer, outputStorageStrategy, resourceNameValidator, }) => {
        if (!this.generator) {
            this.generator = new FunctionGenerator(this.hydrateDefaults(resourceNameValidator), outputStorageStrategy);
        }
        return constructContainer.getOrCompute(this.generator);
    };
    hydrateDefaults = (resourceNameValidator) => {
        const name = this.resolveName();
        resourceNameValidator?.validate(name);
        return {
            name,
            entry: this.resolveEntry(),
            timeoutSeconds: this.resolveTimeout(),
            memoryMB: this.resolveMemory(),
            ephemeralStorageSizeMB: this.resolveEphemeralStorageSize(),
            environment: this.resolveEnvironment(),
            runtime: this.resolveRuntime(),
            architecture: this.resolveArchitecture(),
            schedule: this.resolveSchedule(),
            bundling: this.resolveBundling(),
            layers: this.props.layers ?? {},
            resourceGroupName: this.props.resourceGroupName ?? 'function',
            logging: this.props.logging ?? {},
        };
    };
    resolveName = () => {
        // If name is set explicitly, use that
        if (this.props.name) {
            return this.props.name;
        }
        // If entry is set, use the basename of the entry path
        if (this.props.entry) {
            return path.parse(this.props.entry).name;
        }
        // Otherwise, use the directory name where the function is defined
        return path.basename(new CallerDirectoryExtractor(this.callerStack).extract());
    };
    resolveEntry = () => {
        // if entry is not set, default to handler.ts
        if (!this.props.entry) {
            return path.join(new CallerDirectoryExtractor(this.callerStack).extract(), 'handler.ts');
        }
        // if entry is absolute use that
        if (path.isAbsolute(this.props.entry)) {
            return this.props.entry;
        }
        // if entry is relative, compute with respect to the caller directory
        return path.join(new CallerDirectoryExtractor(this.callerStack).extract(), this.props.entry);
    };
    resolveTimeout = () => {
        const timeoutMin = 1;
        const timeoutMax = 60 * 15; // 15 minutes in seconds
        const timeoutDefault = 3;
        if (this.props.timeoutSeconds === undefined) {
            return timeoutDefault;
        }
        if (!isWholeNumberBetweenInclusive(this.props.timeoutSeconds, timeoutMin, timeoutMax)) {
            throw new AmplifyUserError('InvalidTimeoutError', {
                message: `Invalid function timeout of ${this.props.timeoutSeconds}`,
                resolution: `timeoutSeconds must be a whole number between ${timeoutMin} and ${timeoutMax} inclusive`,
            });
        }
        return this.props.timeoutSeconds;
    };
    resolveMemory = () => {
        const memoryMin = 128;
        const memoryMax = 10240;
        const memoryDefault = 512;
        if (this.props.memoryMB === undefined) {
            return memoryDefault;
        }
        if (!isWholeNumberBetweenInclusive(this.props.memoryMB, memoryMin, memoryMax)) {
            throw new AmplifyUserError('InvalidMemoryMBError', {
                message: `Invalid function memoryMB of ${this.props.memoryMB}`,
                resolution: `memoryMB must be a whole number between ${memoryMin} and ${memoryMax} inclusive`,
            });
        }
        return this.props.memoryMB;
    };
    resolveEphemeralStorageSize = () => {
        const ephemeralStorageSizeMin = 512;
        const ephemeralStorageSizeMax = 10240;
        const ephemeralStorageSizeDefault = 512;
        if (this.props.ephemeralStorageSizeMB === undefined) {
            return ephemeralStorageSizeDefault;
        }
        if (!isWholeNumberBetweenInclusive(this.props.ephemeralStorageSizeMB, ephemeralStorageSizeMin, ephemeralStorageSizeMax)) {
            throw new AmplifyUserError('InvalidEphemeralStorageSizeMBError', {
                message: `Invalid function ephemeralStorageSizeMB of ${this.props.ephemeralStorageSizeMB}`,
                resolution: `ephemeralStorageSizeMB must be a whole number between ${ephemeralStorageSizeMin} and ${ephemeralStorageSizeMax} inclusive`,
            });
        }
        return this.props.ephemeralStorageSizeMB;
    };
    resolveEnvironment = () => {
        if (this.props.environment === undefined) {
            return {};
        }
        const invalidKeys = [];
        Object.keys(this.props.environment).forEach((key) => {
            // validate using key pattern from https://docs.aws.amazon.com/lambda/latest/api/API_Environment.html
            if (!key.match(/^[a-zA-Z]([a-zA-Z0-9_])+$/)) {
                invalidKeys.push(key);
            }
        });
        if (invalidKeys.length > 0) {
            throw new AmplifyUserError('InvalidEnvironmentKeyError', {
                message: `Invalid function environment key(s): ${invalidKeys.join(', ')}`,
                resolution: 'Environment keys must match [a-zA-Z]([a-zA-Z0-9_])+ and be at least 2 characters',
            });
        }
        return this.props.environment;
    };
    resolveRuntime = () => {
        const runtimeDefault = 18;
        // if runtime is not set, default to the oldest LTS
        if (!this.props.runtime) {
            return runtimeDefault;
        }
        if (!(this.props.runtime in nodeVersionMap)) {
            throw new AmplifyUserError('InvalidRuntimeError', {
                message: `Invalid function runtime of ${this.props.runtime}`,
                resolution: `runtime must be one of the following: ${Object.keys(nodeVersionMap).join(', ')}`,
            });
        }
        return this.props.runtime;
    };
    resolveArchitecture = () => {
        const architectureDefault = 'x86_64';
        if (!this.props.architecture) {
            return architectureDefault;
        }
        if (!(this.props.architecture in architectureMap)) {
            throw new AmplifyUserError('InvalidArchitectureError', {
                message: `Invalid function architecture of ${this.props.architecture}`,
                resolution: `architecture must be one of the following: ${Object.keys(architectureMap).join(', ')}`,
            });
        }
        return this.props.architecture;
    };
    resolveSchedule = () => {
        if (!this.props.schedule) {
            return [];
        }
        return this.props.schedule;
    };
    resolveBundling = () => {
        const bundlingDefault = {
            format: OutputFormat.ESM,
            bundleAwsSDK: true,
            loader: {
                '.node': 'file',
            },
            minify: true,
            sourceMap: true,
        };
        return {
            ...bundlingDefault,
            minify: this.resolveMinify(this.props.bundling),
        };
    };
    resolveMinify = (bundling) => {
        return bundling?.minify === undefined ? true : bundling.minify;
    };
}
class FunctionGenerator {
    props;
    outputStorageStrategy;
    resourceGroupName;
    constructor(props, outputStorageStrategy) {
        this.props = props;
        this.outputStorageStrategy = outputStorageStrategy;
        this.resourceGroupName = props.resourceGroupName;
    }
    generateContainerEntry = ({ scope, backendSecretResolver, }) => {
        // Move layer resolution here where we have access to scope
        const parser = new FunctionLayerArnParser(Stack.of(scope).region, Stack.of(scope).account);
        const resolvedLayerArns = parser.parseLayers(this.props.layers ?? {}, this.props.name);
        // resolve layers to LayerVersion objects for the NodejsFunction constructor
        const resolvedLayers = Object.entries(resolvedLayerArns).map(([key, arn]) => LayerVersion.fromLayerVersionArn(scope, `${this.props.name}-${key}-layer`, arn));
        return new AmplifyFunction(scope, this.props.name, { ...this.props, resolvedLayers }, backendSecretResolver, this.outputStorageStrategy);
    };
}
class AmplifyFunction extends Construct {
    resources;
    stack;
    functionEnvironmentTranslator;
    constructor(scope, id, props, backendSecretResolver, outputStorageStrategy) {
        super(scope, id);
        this.stack = Stack.of(scope);
        const runtime = nodeVersionMap[props.runtime];
        const require = createRequire(import.meta.url);
        const shims = runtime === Runtime.NODEJS_16_X
            ? []
            : [require.resolve('./lambda-shims/cjs_shim')];
        const ssmResolverFile = runtime === Runtime.NODEJS_16_X
            ? require.resolve('./lambda-shims/resolve_ssm_params_sdk_v2') // use aws cdk v2 in node 16
            : require.resolve('./lambda-shims/resolve_ssm_params');
        const invokeSsmResolverFile = require.resolve('./lambda-shims/invoke_ssm_shim');
        /**
         * This code concatenates the contents of the ssm resolver and invoker into a single line that can be used as the esbuild banner content
         * This banner is responsible for resolving the customer's SSM parameters at runtime
         */
        const bannerCode = readFileSync(ssmResolverFile, 'utf-8')
            .concat(readFileSync(invokeSsmResolverFile, 'utf-8'))
            .split(new RegExp(`${EOL}|\n|\r`, 'g'))
            .map((line) => line.replace(/\/\/.*$/, '')) // strip out inline comments because the banner is going to be flattened into a single line
            .join('');
        const functionEnvironmentTypeGenerator = new FunctionEnvironmentTypeGenerator(id);
        // esbuild runs as part of the NodejsFunction constructor, so we eagerly generate the process env shim without types so it can be included in the function bundle.
        // This will be overwritten with the typed file at the end of synthesis
        functionEnvironmentTypeGenerator.generateProcessEnvShim();
        let functionLambda;
        const cdkLoggingOptions = convertLoggingOptionsToCDK(props.logging);
        try {
            functionLambda = new NodejsFunction(scope, `${id}-lambda`, {
                entry: props.entry,
                timeout: Duration.seconds(props.timeoutSeconds),
                memorySize: props.memoryMB,
                architecture: architectureMap[props.architecture],
                ephemeralStorageSize: Size.mebibytes(props.ephemeralStorageSizeMB),
                runtime: nodeVersionMap[props.runtime],
                layers: props.resolvedLayers,
                bundling: {
                    ...props.bundling,
                    banner: bannerCode,
                    inject: shims,
                    externalModules: Object.keys(props.layers),
                },
                logRetention: cdkLoggingOptions.retention,
                applicationLogLevelV2: cdkLoggingOptions.level,
                loggingFormat: cdkLoggingOptions.format,
            });
        }
        catch (error) {
            // If the error is from ES Bundler which is executed as a child process by CDK,
            // then the error from CDK contains the command that was executed along with the exit status.
            // Wrapping it here  would cause the cdk_deployer to re-throw this wrapped exception
            // instead of scraping the stderr for actual ESBuild error.
            if (error instanceof Error &&
                error.message.match(/Failed to bundle asset.*exited with status/)) {
                throw error;
            }
            throw new AmplifyUserError('NodeJSFunctionConstructInitializationError', {
                message: 'Failed to instantiate nodejs function construct',
                resolution: 'See the underlying error message for more details. Use `--debug` for additional debugging information.',
            }, error);
        }
        try {
            const schedules = convertFunctionSchedulesToRuleSchedules(functionLambda, props.schedule);
            const lambdaTarget = new targets.LambdaFunction(functionLambda);
            schedules.forEach((schedule, index) => {
                // Lambda name will be prepended to rule id, so only using index here for uniqueness
                const rule = new Rule(functionLambda, `schedule${index}`, {
                    schedule,
                });
                rule.addTarget(lambdaTarget);
            });
        }
        catch (error) {
            throw new AmplifyUserError('FunctionScheduleInitializationError', {
                message: 'Failed to instantiate schedule for nodejs function',
                resolution: 'See the underlying error message for more details.',
            }, error);
        }
        Tags.of(functionLambda).add(TagName.FRIENDLY_NAME, id);
        this.functionEnvironmentTranslator = new FunctionEnvironmentTranslator(functionLambda, props.environment, backendSecretResolver, functionEnvironmentTypeGenerator);
        this.resources = {
            lambda: functionLambda,
            cfnResources: {
                cfnFunction: functionLambda.node.findChild('Resource'),
            },
        };
        this.storeOutput(outputStorageStrategy);
        new AttributionMetadataStorage().storeAttributionMetadata(Stack.of(this), functionStackType, fileURLToPath(new URL('../package.json', import.meta.url)));
    }
    addEnvironment = (key, value) => {
        this.functionEnvironmentTranslator.addEnvironmentEntry(key, value);
    };
    getResourceAccessAcceptor = () => ({
        identifier: `${this.node.id}LambdaResourceAccessAcceptor`,
        acceptResourceAccess: (policy, ssmEnvironmentEntries) => {
            const role = this.resources.lambda.role;
            if (!role) {
                // This should never happen since we are using the Function L2 construct
                throw new Error('No execution role found to attach lambda permissions to');
            }
            policy.attachToRole(role);
            ssmEnvironmentEntries.forEach(({ name, path }) => {
                this.functionEnvironmentTranslator.addSsmEnvironmentEntry(name, path);
            });
        },
    });
    /**
     * Store storage outputs using provided strategy
     */
    storeOutput = (outputStorageStrategy) => {
        outputStorageStrategy.appendToBackendOutputList(functionOutputKey, {
            version: '1',
            payload: {
                definedFunctions: this.resources.lambda.functionName,
            },
        });
    };
}
const isWholeNumberBetweenInclusive = (test, min, max) => min <= test && test <= max && test % 1 === 0;
const nodeVersionMap = {
    16: Runtime.NODEJS_16_X,
    18: Runtime.NODEJS_18_X,
    20: Runtime.NODEJS_20_X,
    22: Runtime.NODEJS_22_X,
};
const architectureMap = {
    arm64: Architecture.ARM_64,
    x86_64: Architecture.X86_64,
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFjdG9yeS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9mYWN0b3J5LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFFTCxpQkFBaUIsR0FDbEIsTUFBTSxxQ0FBcUMsQ0FBQztBQUM3QyxPQUFPLEVBQUUsMEJBQTBCLEVBQUUsTUFBTSxxQ0FBcUMsQ0FBQztBQUNqRixPQUFPLEVBQ0wsZ0JBQWdCLEVBQ2hCLHdCQUF3QixFQUN4QixPQUFPLEdBQ1IsTUFBTSw0QkFBNEIsQ0FBQztBQW1CcEMsT0FBTyxFQUFFLFFBQVEsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksRUFBRSxNQUFNLGFBQWEsQ0FBQztBQUMxRCxPQUFPLEVBQUUsSUFBSSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7QUFDOUMsT0FBTyxLQUFLLE9BQU8sTUFBTSxnQ0FBZ0MsQ0FBQztBQUUxRCxPQUFPLEVBQ0wsWUFBWSxFQUdaLFlBQVksRUFDWixPQUFPLEdBQ1IsTUFBTSx3QkFBd0IsQ0FBQztBQUNoQyxPQUFPLEVBQUUsY0FBYyxFQUFFLFlBQVksRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQzdFLE9BQU8sRUFBRSxTQUFTLEVBQUUsTUFBTSxZQUFZLENBQUM7QUFDdkMsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLElBQUksQ0FBQztBQUNsQyxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBQ3ZDLE9BQU8sRUFBRSxhQUFhLEVBQUUsTUFBTSxVQUFVLENBQUM7QUFDekMsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLElBQUksQ0FBQztBQUN6QixPQUFPLEtBQUssSUFBSSxNQUFNLE1BQU0sQ0FBQztBQUM3QixPQUFPLEVBQUUsNkJBQTZCLEVBQUUsTUFBTSw4QkFBOEIsQ0FBQztBQUM3RSxPQUFPLEVBQUUsZ0NBQWdDLEVBQUUsTUFBTSxrQ0FBa0MsQ0FBQztBQUNwRixPQUFPLEVBQUUsc0JBQXNCLEVBQUUsTUFBTSxtQkFB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QU8sRUFBRSxHQUFHO1lBQ1osT0FBTyxFQUFFO2dCQUNQLGdCQUFnQixFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLFlBQVk7YUFDckQ7U0FDRixDQUFDLENBQUM7SUFDTCxDQUFDLENBQUM7Q0FDSDtBQUVELE1BQU0sNkJBQTZCLEdBQUcsQ0FDcEMsSUFBWSxFQUNaLEdBQVcsRUFDWCxHQUFXLEVBQ1gsRUFBRSxDQUFDLEdBQUcsSUFBSSxJQUFJLElBQUksSUFBSSxJQUFJLEdBQUcsSUFBSSxJQUFJLEdBQUcsQ0FBQyxLQUFLLENBQUMsQ0FBQztBQUlsRCxNQUFNLGNBQWMsR0FBaUM7SUFDbkQsRUFBRSxFQUFFLE9BQU8sQ0FBQyxXQUFXO0lBQ3ZCLEVBQUUsRUFBRSxPQUFPLENBQUMsV0FBVztJQUN2QixFQUFFLEVBQUUsT0FBTyxDQUFDLFdBQVc7SUFDdkIsRUFBRSxFQUFFLE9BQU8sQ0FBQyxXQUFXO0NBQ3hCLENBQUM7QUFJRixNQUFNLGVBQWUsR0FBK0M7SUFDbEUsS0FBSyxFQUFFLFlBQVksQ0FBQyxNQUFNO0lBQzFCLE1BQU0sRUFBRSxZQUFZLENBQUMsTUFBTTtDQUM1QixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgRnVuY3Rpb25PdXRwdXQsXG4gIGZ1bmN0aW9uT3V0cHV0S2V5LFxufSBmcm9tICdAYXdzLWFtcGxpZnkvYmFja2VuZC1vdXRwdXQtc2NoZW1hcyc7XG5pbXBvcnQgeyBBdHRyaWJ1dGlvbk1ldGFkYXRhU3RvcmFnZSB9IGZyb20gJ0Bhd3MtYW1wbGlmeS9iYWNrZW5kLW91dHB1dC1zdG9yYWdlJztcbmltcG9ydCB7XG4gIEFtcGxpZnlVc2VyRXJyb3IsXG4gIENhbGxlckRpcmVjdG9yeUV4dHJhY3RvcixcbiAgVGFnTmFtZSxcbn0gZnJvbSAnQGF3cy1hbXBsaWZ5L3BsYXRmb3JtLWNvcmUnO1xuaW1wb3J0IHtcbiAgQW1wbGlmeVJlc291cmNlR3JvdXBOYW1lLFxuICBCYWNrZW5kT3V0cHV0U3RvcmFnZVN0cmF0ZWd5LFxuICBCYWNrZW5kU2VjcmV0LFxuICBCYWNrZW5kU2VjcmV0UmVzb2x2ZXIsXG4gIENvbnN0cnVjdENvbnRhaW5lckVudHJ5R2VuZXJhdG9yLFxuICBDb25zdHJ1Y3RGYWN0b3J5LFxuICBDb25zdHJ1Y3RGYWN0b3J5R2V0SW5zdGFuY2VQcm9wcyxcbiAgRnVuY3Rpb25SZXNvdXJjZXMsXG4gIEdlbmVyYXRlQ29udGFpbmVyRW50cnlQcm9wcyxcbiAgTG9nTGV2ZWwsXG4gIExvZ1JldGVudGlvbixcbiAgUmVzb3VyY2VBY2Nlc3NBY2NlcHRvckZhY3RvcnksXG4gIFJlc291cmNlTmFtZVZhbGlkYXRvcixcbiAgUmVzb3VyY2VQcm92aWRlcixcbiAgU3NtRW52aXJvbm1lbnRFbnRyeSxcbiAgU3RhY2tQcm92aWRlcixcbn0gZnJvbSAnQGF3cy1hbXBsaWZ5L3BsdWdpbi10eXBlcyc7XG5pbXBvcnQgeyBEdXJhdGlvbiwgU2l6ZSwgU3RhY2ssIFRhZ3MgfSBmcm9tICdhd3MtY2RrLWxpYic7XG5pbXBvcnQgeyBSdWxlIH0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWV2ZW50cyc7XG5pbXBvcnQgKiBhcyB0YXJnZXRzIGZyb20gJ2F3cy1jZGstbGliL2F3cy1ldmVudHMtdGFyZ2V0cyc7XG5pbXBvcnQgeyBQb2xpY3kgfSBmcm9tICdhd3MtY2RrLWxpYi9hd3MtaWFtJztcbmltcG9ydCB7XG4gIEFyY2hpdGVjdHVyZSxcbiAgQ2ZuRnVuY3Rpb24sXG4gIElMYXllclZlcnNpb24sXG4gIExheWVyVmVyc2lvbixcbiAgUnVudGltZSxcbn0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWxhbWJkYSc7XG5pbXBvcnQgeyBOb2RlanNGdW5jdGlvbiwgT3V0cHV0Rm9ybWF0IH0gZnJvbSAnYXdzLWNkay1saWIvYXdzLWxhbWJkYS1ub2RlanMnO1xuaW1wb3J0IHsgQ29uc3RydWN0IH0gZnJvbSAnY29uc3RydWN0cyc7XG5pbXBvcnQgeyByZWFkRmlsZVN5bmMgfSBmcm9tICdmcyc7XG5pbXBvcnQgeyBjcmVhdGVSZXF1aXJlIH0gZnJvbSAnbW9kdWxlJztcbmltcG9ydCB7IGZpbGVVUkxUb1BhdGggfSBmcm9tICdub2RlOnVybCc7XG5pbXBvcnQgeyBFT0wgfSBmcm9tICdvcyc7XG5pbXBvcnQgKiBhcyBwYXRoIGZyb20gJ3BhdGgnO1xuaW1wb3J0IHsgRnVuY3Rpb25FbnZpcm9ubWVudFRyYW5zbGF0b3IgfSBmcm9tICcuL2Z1bmN0aW9uX2Vudl90cmFuc2xhdG9yLmpzJztcbmltcG9ydCB7IEZ1bmN0aW9uRW52aXJvbm1lbnRUeXBlR2VuZXJhdG9yIH0gZnJvbSAnLi9mdW5jdGlvbl9lbnZfdHlwZV9nZW5lcmF0b3IuanMnO1xuaW1wb3J0IHsgRnVuY3Rpb25MYXllckFyblBhcnNlciB9IGZyb20gJy4vbGF5ZXJfcGFyc2VyLmpzJztcbmltcG9ydCB7IGNvbnZlcnRMb2dnaW5nT3B0aW9uc1RvQ0RLIH0gZnJvbSAnLi9sb2dnaW5nX29wdGlvbnNfcGFyc2VyLmpzJztcbmltcG9ydCB7IGNvbnZlcnRGdW5jdGlvblNjaGVkdWxlc1RvUnVsZVNjaGVkdWxlcyB9IGZyb20gJy4vc2NoZWR1bGVfcGFyc2VyLmpzJztcblxuY29uc3QgZnVuY3Rpb25TdGFja1R5cGUgPSAnZnVuY3Rpb24tTGFtYmRhJztcblxuZXhwb3J0IHR5cGUgQWRkRW52aXJvbm1lbnRGYWN0b3J5ID0ge1xuICBhZGRFbnZpcm9ubWVudDogKGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nIHwgQmFja2VuZFNlY3JldCkgPT4gdm9pZDtcbn07XG5cbmV4cG9ydCB0eXBlIENyb25TY2hlZHVsZSA9XG4gIHwgYCR7c3RyaW5nfSAke3N0cmluZ30gJHtzdHJpbmd9ICR7c3RyaW5nfSAke3N0cmluZ31gXG4gIHwgYCR7c3RyaW5nfSAke3N0cmluZ30gJHtzdHJpbmd9ICR7c3RyaW5nfSAke3N0cmluZ30gJHtzdHJpbmd9YDtcbmV4cG9ydCB0eXBlIFRpbWVJbnRlcnZhbCA9XG4gIHwgYGV2ZXJ5ICR7bnVtYmVyfW1gXG4gIHwgYGV2ZXJ5ICR7bnVtYmVyfWhgXG4gIHwgYGV2ZXJ5IGRheWBcbiAgfCBgZXZlcnkgd2Vla2BcbiAgfCBgZXZlcnkgbW9udGhgXG4gIHwgYGV2ZXJ5IHllYXJgO1xuZXhwb3J0IHR5cGUgRnVuY3Rpb25TY2hlZHVsZSA9IFRpbWVJbnRlcnZhbCB8IENyb25TY2hlZHVsZTtcblxuZXhwb3J0IHR5cGUgRnVuY3Rpb25Mb2dMZXZlbCA9IEV4dHJhY3Q8XG4gIExvZ0xldmVsLFxuICAnaW5mbycgfCAnZGVidWcnIHwgJ3dhcm4nIHwgJ2Vycm9yJyB8ICdmYXRhbCcgfCAndHJhY2UnXG4+O1xuZXhwb3J0IHR5cGUgRnVuY3Rpb25Mb2dSZXRlbnRpb24gPSBMb2dSZXRlbnRpb247XG5cbi8qKlxuICogRW50cnkgcG9pbnQgZm9yIGRlZmluaW5nIGEgZnVuY3Rpb24gaW4gdGhlIEFtcGxpZnkgZWNvc3lzdGVtXG4gKi9cbmV4cG9ydCBjb25zdCBkZWZpbmVGdW5jdGlvbiA9IChcbiAgcHJvcHM6IEZ1bmN0aW9uUHJvcHMgPSB7fVxuKTogQ29uc3RydWN0RmFjdG9yeTxcbiAgUmVzb3VyY2VQcm92aWRlcjxGdW5jdGlvblJlc291cmNlcz4gJlxuICAgIFJlc291cmNlQWNjZXNzQWNjZXB0b3JGYWN0b3J5ICZcbiAgICBBZGRFbnZpcm9ubWVudEZhY3RvcnkgJlxuICAgIFN0YWNrUHJvdmlkZXJcbj4gPT4gbmV3IEZ1bmN0aW9uRmFjdG9yeShwcm9wcywgbmV3IEVycm9yKCkuc3RhY2spO1xuXG5leHBvcnQgdHlwZSBGdW5jdGlvblByb3BzID0ge1xuICAvKipcbiAgICogQSBuYW1lIGZvciB0aGUgZnVuY3Rpb24uXG4gICAqIERlZmF1bHRzIHRvIHRoZSBiYXNlbmFtZSBvZiB0aGUgZW50cnkgcGF0aCBpZiBzcGVjaWZpZWQuXG4gICAqIElmIG5vIGVudHJ5IGlzIHNwZWNpZmllZCwgZGVmYXVsdHMgdG8gdGhlIGRpcmVjdG9yeSBuYW1lIGluIHdoaWNoIHRoaXMgZnVuY3Rpb24gaXMgZGVmaW5lZC5cbiAgICpcbiAgICogRXhhbXBsZTpcbiAgICogSWYgZW50cnkgaXMgYC4vc2NoZWR1bGVkLWRiLWJhY2t1cC50c2AgdGhlIG5hbWUgd2lsbCBkZWZhdWx0IHRvIFwic2NoZWR1bGVkLWRiLWJhY2t1cFwiXG4gICAqIElmIGVudHJ5IGlzIG5vdCBzZXQgYW5kIHRoZSBmdW5jdGlvbiBpcyBkZWZpbmVkIGluIGBhbXBsaWZ5L2Z1bmN0aW9ucy9kYi1iYWNrdXAvcmVzb3VyY2UudHNgIHRoZSBuYW1lIHdpbGwgZGVmYXVsdCB0byBcImRiLWJhY2t1cFwiXG4gICAqL1xuICBuYW1lPzogc3RyaW5nO1xuICAvKipcbiAgICogVGhlIHBhdGggdG8gdGhlIGZpbGUgdGhhdCBjb250YWlucyB0aGUgZnVuY3Rpb24gZW50cnkgcG9pbnQuXG4gICAqIElmIHRoaXMgaXMgYSByZWxhdGl2ZSBwYXRoLCBpdCBpcyBjb21wdXRlZCByZWxhdGl2ZSB0byB0aGUgZmlsZSB3aGVyZSB0aGlzIGZ1bmN0aW9uIGlzIGRlZmluZWRcbiAgICpcbiAgICogRGVmYXVsdHMgdG8gJy4vaGFuZGxlci50cydcbiAgICovXG4gIGVudHJ5Pzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBBbiBhbW91bnQgb2YgdGltZSBpbiBzZWNvbmRzIGJldHdlZW4gMSBzZWNvbmQgYW5kIDE1IG1pbnV0ZXMuXG4gICAqIE11c3QgYmUgYSB3aG9sZSBudW1iZXIuXG4gICAqIERlZmF1bHQgaXMgMyBzZWNvbmRzLlxuICAgKi9cbiAgdGltZW91dFNlY29uZHM/OiBudW1iZXI7XG5cbiAgLyoqXG4gICAqIEFuIGFtb3VudCBvZiBtZW1vcnkgKFJBTSkgdG8gYWxsb2NhdGUgdG8gdGhlIGZ1bmN0aW9uIGJldHdlZW4gMTI4IGFuZCAxMDI0MCBNQi5cbiAgICogTXVzdCBiZSBhIHdob2xlIG51bWJlci5cbiAgICogRGVmYXVsdCBpcyA1MTJNQi5cbiAgICovXG4gIG1lbW9yeU1CPzogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBUaGUgc2l6ZSBvZiB0aGUgZnVuY3Rpb24ncyAvdG1wIGRpcmVjdG9yeSBpbiBNQi5cbiAgICogTXVzdCBiZSBhIHdob2xlIG51bWJlci5cbiAgICogQGRlZmF1bHQgNTEyXG4gICAqL1xuICBlcGhlbWVyYWxTdG9yYWdlU2l6ZU1CPzogbnVtYmVyO1xuXG4gIC8qKlxuICAgKiBFbnZpcm9ubWVudCB2YXJpYWJsZXMgdGhhdCB3aWxsIGJlIGF2YWlsYWJsZSBkdXJpbmcgZnVuY3Rpb24gZXhlY3V0aW9uXG4gICAqL1xuICBlbnZpcm9ubWVudD86IFJlY29yZDxzdHJpbmcsIHN0cmluZyB8IEJhY2tlbmRTZWNyZXQ+O1xuXG4gIC8qKlxuICAgKiBOb2RlIHJ1bnRpbWUgdmVyc2lvbiBmb3IgdGhlIGxhbWJkYSBlbnZpcm9ubWVudC5cbiAgICpcbiAgICogRGVmYXVsdHMgdG8gdGhlIG9sZGVzdCBOb2RlSlMgTFRTIHZlcnNpb24uIFNlZSBodHRwczovL25vZGVqcy5vcmcvZW4vYWJvdXQvcHJldmlvdXMtcmVsZWFzZXNcbiAgICovXG4gIHJ1bnRpbWU/OiBOb2RlVmVyc2lvbjtcblxuICAvKipcbiAgICogVGhlIGFyY2hpdGVjdHVyZSBvZiB0aGUgdGFyZ2V0IHBsYXRmb3JtIGZvciB0aGUgbGFtYmRhIGVudmlyb25tZW50LlxuICAgKiBEZWZhdWx0cyB0byBYODZfNjQuXG4gICAqL1xuICBhcmNoaXRlY3R1cmU/OiBGdW5jdGlvbkFyY2hpdGVjdHVyZTtcblxuICAvKipcbiAgICogQSB0aW1lIGludGVydmFsIHN0cmluZyB0byBwZXJpb2RpY2FsbHkgcnVuIHRoZSBmdW5jdGlvbi5cbiAgICogVGhpcyBjYW4gYmUgZWl0aGVyIGEgc3RyaW5nIG9mIGBcImV2ZXJ5IDxwb3NpdGl2ZSB3aG9sZSBudW1iZXI+PG0gKG1pbnV0ZSkgb3IgaCAoaG91cik+XCJgLCBgXCJldmVyeSBkYXl8d2Vla3xtb250aHx5ZWFyXCJgIG9yIGNyb24gZXhwcmVzc2lvbi5cbiAgICogRGVmYXVsdHMgdG8gbm8gc2NoZWR1bGluZyBmb3IgdGhlIGZ1bmN0aW9uLlxuICAgKiBAZXhhbXBsZVxuICAgKiBzY2hlZHVsZTogXCJldmVyeSA1bVwiXG4gICAqIEBleGFtcGxlXG4gICAqIHNjaGVkdWxlOiBcImV2ZXJ5IHdlZWtcIlxuICAgKiBAZXhhbXBsZVxuICAgKiBzY2hlZHVsZTogXCIwIDkgPyAqIDIgKlwiIC8vIGV2ZXJ5IE1vbmRheSBhdCA5YW1cbiAgICovXG4gIHNjaGVkdWxlPzogRnVuY3Rpb25TY2hlZHVsZSB8IEZ1bmN0aW9uU2NoZWR1bGVbXTtcblxuICAvKipcbiAgICogQXR0YWNoIExhbWJkYSBsYXllcnMgdG8gYSBmdW5jdGlvblxuICAgKiAtIEEgTGFtYmRhIGxheWVyIGlzIHJlcHJlc2VudGVkIGJ5IGFuIG9iamVjdCBvZiBrZXkvdmFsdWUgcGFpciB3aGVyZSB0aGUga2V5IGlzIHRoZSBtb2R1bGUgbmFtZSB0aGF0IGlzIGV4cG9ydGVkIGZyb20geW91ciBsYXllciBhbmQgdGhlIHZhbHVlIGlzIHRoZSBBUk4gb2YgdGhlIGxheWVyLiBUaGUga2V5IChtb2R1bGUgbmFtZSkgaXMgdXNlZCB0byBleHRlcm5hbGl6ZSB0aGUgbW9kdWxlIGRlcGVuZGVuY3kgc28gaXQgZG9lc24ndCBnZXQgYnVuZGxlZCB3aXRoIHlvdXIgbGFtYmRhIGZ1bmN0aW9uXG4gICAqIC0gTWF4aW11bSBvZiA1IGxheWVycyBjYW4gYmUgYXR0YWNoZWQgdG8gYSBmdW5jdGlvbiBhbmQgbXVzdCBiZSBpbiB0aGUgc2FtZSByZWdpb24gYXMgdGhlIGZ1bmN0aW9uLlxuICAgKiBAZXhhbXBsZVxuICAgKiBsYXllcnM6IHtcbiAgICogICAgXCJAYXdzLWxhbWJkYS1wb3dlcnRvb2xzL2xvZ2dlclwiOiBcImFybjphd3M6bGFtYmRhOjxjdXJyZW50LXJlZ2lvbj46MDk0Mjc0MTA1OTE1OmxheWVyOkFXU0xhbWJkYVBvd2VydG9vbHNUeXBlU2NyaXB0VjI6MTFcIlxuICAgKiB9LFxuICAgKiBvclxuICAgKiBAZXhhbXBsZVxuICAgKiBsYXllcnM6IHtcbiAgICogICAgXCJTaGFycFwiOiBcIlNoYXJwTGF5ZXI6MVwiXG4gICAqIH0sXG4gICAqIEBzZWUgW0FtcGxpZnkgZG9jdW1lbnRhdGlvbiBmb3IgTGFtYmRhIGxheWVyc10oaHR0cHM6Ly9kb2NzLmFtcGxpZnkuYXdzL3JlYWN0L2J1aWxkLWEtYmFja2VuZC9mdW5jdGlvbnMvYWRkLWxhbWJkYS1sYXllcnMpXG4gICAqIEBzZWUgW0FXUyBkb2N1bWVudGF0aW9uIGZvciBMYW1iZGEgbGF5ZXJzXShodHRwczovL2RvY3MuYXdzLmFtYXpvbi5jb20vbGFtYmRhL2xhdGVzdC9kZy9jaGFwdGVyLWxheWVycy5odG1sKVxuICAgKi9cbiAgbGF5ZXJzPzogUmVjb3JkPHN0cmluZywgc3RyaW5nPjtcblxuICAvKlxuICAgKiBPcHRpb25zIGZvciBidW5kbGluZyB0aGUgZnVuY3Rpb24gY29kZS5cbiAgICovXG4gIGJ1bmRsaW5nPzogRnVuY3Rpb25CdW5kbGluZ09wdGlvbnM7XG5cbiAgLyoqXG4gICAqIEdyb3VwIHRoZSBmdW5jdGlvbiB3aXRoIGV4aXN0aW5nIEFtcGxpZnkgcmVzb3VyY2VzIG9yIHNlcGFyYXRlIHRoZSBmdW5jdGlvbiBpbnRvIGl0cyBvd24gZ3JvdXAuXG4gICAqIEBkZWZhdWx0ICdmdW5jdGlvbicgLy8gZ3JvdXBpbmcgd2l0aCBvdGhlciBBbXBsaWZ5IGZ1bmN0aW9uc1xuICAgKiBAZXhhbXBsZVxuICAgKiByZXNvdXJjZUdyb3VwTmFtZTogJ2F1dGgnIC8vIHRvIGdyb3VwIGFuIGF1dGggdHJpZ2dlciB3aXRoIGFuIGF1dGggcmVzb3VyY2VcbiAgICovXG4gIHJlc291cmNlR3JvdXBOYW1lPzogQW1wbGlmeVJlc291cmNlR3JvdXBOYW1lO1xuXG4gIGxvZ2dpbmc/OiBGdW5jdGlvbkxvZ2dpbmdPcHRpb25zO1xufTtcblxuZXhwb3J0IHR5cGUgRnVuY3Rpb25CdW5kbGluZ09wdGlvbnMgPSB7XG4gIC8qKlxuICAgKiBXaGV0aGVyIHRvIG1pbmlmeSB0aGUgZnVuY3Rpb24gY29kZS5cbiAgICpcbiAgICogRGVmYXVsdHMgdG8gdHJ1ZS5cbiAgICovXG4gIG1pbmlmeT86IGJvb2xlYW47XG59O1xuXG5leHBvcnQgdHlwZSBGdW5jdGlvbkxvZ2dpbmdPcHRpb25zID0gKFxuICB8IHtcbiAgICAgIGZvcm1hdDogJ2pzb24nO1xuICAgICAgbGV2ZWw/OiBGdW5jdGlvbkxvZ0xldmVsO1xuICAgIH1cbiAgfCB7XG4gICAgICBmb3JtYXQ/OiAndGV4dCc7XG4gICAgfVxuKSAmIHtcbiAgcmV0ZW50aW9uPzogRnVuY3Rpb25Mb2dSZXRlbnRpb247XG59O1xuXG4vKipcbiAqIENyZWF0ZSBMYW1iZGEgZnVuY3Rpb25zIGluIHRoZSBjb250ZXh0IG9mIGFuIEFtcGxpZnkgYmFja2VuZCBkZWZpbml0aW9uXG4gKi9cbmNsYXNzIEZ1bmN0aW9uRmFjdG9yeSBpbXBsZW1lbnRzIENvbnN0cnVjdEZhY3Rvcnk8QW1wbGlmeUZ1bmN0aW9uPiB7XG4gIHByaXZhdGUgZ2VuZXJhdG9yOiBDb25zdHJ1Y3RDb250YWluZXJFbnRyeUdlbmVyYXRvcjtcbiAgLyoqXG4gICAqIENyZWF0ZSBhIG5ldyBBbXBsaWZ5RnVuY3Rpb25GYWN0b3J5XG4gICAqL1xuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIHJlYWRvbmx5IHByb3BzOiBGdW5jdGlvblByb3BzLFxuICAgIHByaXZhdGUgcmVhZG9ubHkgY2FsbGVyU3RhY2s/OiBzdHJpbmdcbiAgKSB7fVxuXG4gIC8qKlxuICAgKiBDcmVhdGVzIGFuIGluc3RhbmNlIG9mIEFtcGxpZnlGdW5jdGlvbiB3aXRoaW4gdGhlIHByb3ZpZGVkIEFtcGxpZnkgY29udGV4dFxuICAgKi9cbiAgZ2V0SW5zdGFuY2UgPSAoe1xuICAgIGNvbnN0cnVjdENvbnRhaW5lcixcbiAgICBvdXRwdXRTdG9yYWdlU3RyYXRlZ3ksXG4gICAgcmVzb3VyY2VOYW1lVmFsaWRhdG9yLFxuICB9OiBDb25zdHJ1Y3RGYWN0b3J5R2V0SW5zdGFuY2VQcm9wcyk6IEFtcGxpZnlGdW5jdGlvbiA9PiB7XG4gICAgaWYgKCF0aGlzLmdlbmVyYXRvcikge1xuICAgICAgdGhpcy5nZW5lcmF0b3IgPSBuZXcgRnVuY3Rpb25HZW5lcmF0b3IoXG4gICAgICAgIHRoaXMuaHlkcmF0ZURlZmF1bHRzKHJlc291cmNlTmFtZVZhbGlkYXRvciksXG4gICAgICAgIG91dHB1dFN0b3JhZ2VTdHJhdGVneVxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIGNvbnN0cnVjdENvbnRhaW5lci5nZXRPckNvbXB1dGUodGhpcy5nZW5lcmF0b3IpIGFzIEFtcGxpZnlGdW5jdGlvbjtcbiAgfTtcblxuICBwcml2YXRlIGh5ZHJhdGVEZWZhdWx0cyA9IChcbiAgICByZXNvdXJjZU5hbWVWYWxpZGF0b3I/OiBSZXNvdXJjZU5hbWVWYWxpZGF0b3JcbiAgKTogSHlkcmF0ZWRGdW5jdGlvblByb3BzID0+IHtcbiAgICBjb25zdCBuYW1lID0gdGhpcy5yZXNvbHZlTmFtZSgpO1xuICAgIHJlc291cmNlTmFtZVZhbGlkYXRvcj8udmFsaWRhdGUobmFtZSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgbmFtZSxcbiAgICAgIGVudHJ5OiB0aGlzLnJlc29sdmVFbnRyeSgpLFxuICAgICAgdGltZW91dFNlY29uZHM6IHRoaXMucmVzb2x2ZVRpbWVvdXQoKSxcbiAgICAgIG1lbW9yeU1COiB0aGlzLnJlc29sdmVNZW1vcnkoKSxcbiAgICAgIGVwaGVtZXJhbFN0b3JhZ2VTaXplTUI6IHRoaXMucmVzb2x2ZUVwaGVtZXJhbFN0b3JhZ2VTaXplKCksXG4gICAgICBlbnZpcm9ubWVudDogdGhpcy5yZXNvbHZlRW52aXJvbm1lbnQoKSxcbiAgICAgIHJ1bnRpbWU6IHRoaXMucmVzb2x2ZVJ1bnRpbWUoKSxcbiAgICAgIGFyY2hpdGVjdHVyZTogdGhpcy5yZXNvbHZlQXJjaGl0ZWN0dXJlKCksXG4gICAgICBzY2hlZHVsZTogdGhpcy5yZXNvbHZlU2NoZWR1bGUoKSxcbiAgICAgIGJ1bmRsaW5nOiB0aGlzLnJlc29sdmVCdW5kbGluZygpLFxuICAgICAgbGF5ZXJzOiB0aGlzLnByb3BzLmxheWVycyA/PyB7fSxcbiAgICAgIHJlc291cmNlR3JvdXBOYW1lOiB0aGlzLnByb3BzLnJlc291cmNlR3JvdXBOYW1lID8/ICdmdW5jdGlvbicsXG4gICAgICBsb2dnaW5nOiB0aGlzLnByb3BzLmxvZ2dpbmcgPz8ge30sXG4gICAgfTtcbiAgfTtcblxuICBwcml2YXRlIHJlc29sdmVOYW1lID0gKCkgPT4ge1xuICAgIC8vIElmIG5hbWUgaXMgc2V0IGV4cGxpY2l0bHksIHVzZSB0aGF0XG4gICAgaWYgKHRoaXMucHJvcHMubmFtZSkge1xuICAgICAgcmV0dXJuIHRoaXMucHJvcHMubmFtZTtcbiAgICB9XG4gICAgLy8gSWYgZW50cnkgaXMgc2V0LCB1c2UgdGhlIGJhc2VuYW1lIG9mIHRoZSBlbnRyeSBwYXRoXG4gICAgaWYgKHRoaXMucHJvcHMuZW50cnkpIHtcbiAgICAgIHJldHVybiBwYXRoLnBhcnNlKHRoaXMucHJvcHMuZW50cnkpLm5hbWU7XG4gICAgfVxuXG4gICAgLy8gT3RoZXJ3aXNlLCB1c2UgdGhlIGRpcmVjdG9yeSBuYW1lIHdoZXJlIHRoZSBmdW5jdGlvbiBpcyBkZWZpbmVkXG4gICAgcmV0dXJuIHBhdGguYmFzZW5hbWUoXG4gICAgICBuZXcgQ2FsbGVyRGlyZWN0b3J5RXh0cmFjdG9yKHRoaXMuY2FsbGVyU3RhY2spLmV4dHJhY3QoKVxuICAgICk7XG4gIH07XG5cbiAgcHJpdmF0ZSByZXNvbHZlRW50cnkgPSAoKSA9PiB7XG4gICAgLy8gaWYgZW50cnkgaXMgbm90IHNldCwgZGVmYXVsdCB0byBoYW5kbGVyLnRzXG4gICAgaWYgKCF0aGlzLnByb3BzLmVudHJ5KSB7XG4gICAgICByZXR1cm4gcGF0aC5qb2luKFxuICAgICAgICBuZXcgQ2FsbGVyRGlyZWN0b3J5RXh0cmFjdG9yKHRoaXMuY2FsbGVyU3RhY2spLmV4dHJhY3QoKSxcbiAgICAgICAgJ2hhbmRsZXIudHMnXG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIGlmIGVudHJ5IGlzIGFic29sdXRlIHVzZSB0aGF0XG4gICAgaWYgKHBhdGguaXNBYnNvbHV0ZSh0aGlzLnByb3BzLmVudHJ5KSkge1xuICAgICAgcmV0dXJuIHRoaXMucHJvcHMuZW50cnk7XG4gICAgfVxuXG4gICAgLy8gaWYgZW50cnkgaXMgcmVsYXRpdmUsIGNvbXB1dGUgd2l0aCByZXNwZWN0IHRvIHRoZSBjYWxsZXIgZGlyZWN0b3J5XG4gICAgcmV0dXJuIHBhdGguam9pbihcbiAgICAgIG5ldyBDYWxsZXJEaXJlY3RvcnlFeHRyYWN0b3IodGhpcy5jYWxsZXJTdGFjaykuZXh0cmFjdCgpLFxuICAgICAgdGhpcy5wcm9wcy5lbnRyeVxuICAgICk7XG4gIH07XG5cbiAgcHJpdmF0ZSByZXNvbHZlVGltZW91dCA9ICgpID0+IHtcbiAgICBjb25zdCB0aW1lb3V0TWluID0gMTtcbiAgICBjb25zdCB0aW1lb3V0TWF4ID0gNjAgKiAxNTsgLy8gMTUgbWludXRlcyBpbiBzZWNvbmRzXG4gICAgY29uc3QgdGltZW91dERlZmF1bHQgPSAzO1xuICAgIGlmICh0aGlzLnByb3BzLnRpbWVvdXRTZWNvbmRzID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiB0aW1lb3V0RGVmYXVsdDtcbiAgICB9XG5cbiAgICBpZiAoXG4gICAgICAhaXNXaG9sZU51bWJlckJldHdlZW5JbmNsdXNpdmUoXG4gICAgICAgIHRoaXMucHJvcHMudGltZW91dFNlY29uZHMsXG4gICAgICAgIHRpbWVvdXRNaW4sXG4gICAgICAgIHRpbWVvdXRNYXhcbiAgICAgIClcbiAgICApIHtcbiAgICAgIHRocm93IG5ldyBBbXBsaWZ5VXNlckVycm9yKCdJbnZhbGlkVGltZW91dEVycm9yJywge1xuICAgICAgICBtZXNzYWdlOiBgSW52YWxpZCBmdW5jdGlvbiB0aW1lb3V0IG9mICR7dGhpcy5wcm9wcy50aW1lb3V0U2Vjb25kc31gLFxuICAgICAgICByZXNvbHV0aW9uOiBgdGltZW91dFNlY29uZHMgbXVzdCBiZSBhIHdob2xlIG51bWJlciBiZXR3ZWVuICR7dGltZW91dE1pbn0gYW5kICR7dGltZW91dE1heH0gaW5jbHVzaXZlYCxcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5wcm9wcy50aW1lb3V0U2Vjb25kcztcbiAgfTtcblxuICBwcml2YXRlIHJlc29sdmVNZW1vcnkgPSAoKSA9PiB7XG4gICAgY29uc3QgbWVtb3J5TWluID0gMTI4O1xuICAgIGNvbnN0IG1lbW9yeU1heCA9IDEwMjQwO1xuICAgIGNvbnN0IG1lbW9yeURlZmF1bHQgPSA1MTI7XG4gICAgaWYgKHRoaXMucHJvcHMubWVtb3J5TUIgPT09IHVuZGVmaW5lZCkge1xuICAgICAgcmV0dXJuIG1lbW9yeURlZmF1bHQ7XG4gICAgfVxuICAgIGlmIChcbiAgICAgICFpc1dob2xlTnVtYmVyQmV0d2VlbkluY2x1c2l2ZSh0aGlzLnByb3BzLm1lbW9yeU1CLCBtZW1vcnlNaW4sIG1lbW9yeU1heClcbiAgICApIHtcbiAgICAgIHRocm93IG5ldyBBbXBsaWZ5VXNlckVycm9yKCdJbnZhbGlkTWVtb3J5TUJFcnJvcicsIHtcbiAgICAgICAgbWVzc2FnZTogYEludmFsaWQgZnVuY3Rpb24gbWVtb3J5TUIgb2YgJHt0aGlzLnByb3BzLm1lbW9yeU1CfWAsXG4gICAgICAgIHJlc29sdXRpb246IGBtZW1vcnlNQiBtdXN0IGJlIGEgd2hvbGUgbnVtYmVyIGJldHdlZW4gJHttZW1vcnlNaW59IGFuZCAke21lbW9yeU1heH0gaW5jbHVzaXZlYCxcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5wcm9wcy5tZW1vcnlNQjtcbiAgfTtcblxuICBwcml2YXRlIHJlc29sdmVFcGhlbWVyYWxTdG9yYWdlU2l6ZSA9ICgpID0+IHtcbiAgICBjb25zdCBlcGhlbWVyYWxTdG9yYWdlU2l6ZU1pbiA9IDUxMjtcbiAgICBjb25zdCBlcGhlbWVyYWxTdG9yYWdlU2l6ZU1heCA9IDEwMjQwO1xuICAgIGNvbnN0IGVwaGVtZXJhbFN0b3JhZ2VTaXplRGVmYXVsdCA9IDUxMjtcbiAgICBpZiAodGhpcy5wcm9wcy5lcGhlbWVyYWxTdG9yYWdlU2l6ZU1CID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiBlcGhlbWVyYWxTdG9yYWdlU2l6ZURlZmF1bHQ7XG4gICAgfVxuICAgIGlmIChcbiAgICAgICFpc1dob2xlTnVtYmVyQmV0d2VlbkluY2x1c2l2ZShcbiAgICAgICAgdGhpcy5wcm9wcy5lcGhlbWVyYWxTdG9yYWdlU2l6ZU1CLFxuICAgICAgICBlcGhlbWVyYWxTdG9yYWdlU2l6ZU1pbixcbiAgICAgICAgZXBoZW1lcmFsU3RvcmFnZVNpemVNYXhcbiAgICAgIClcbiAgICApIHtcbiAgICAgIHRocm93IG5ldyBBbXBsaWZ5VXNlckVycm9yKCdJbnZhbGlkRXBoZW1lcmFsU3RvcmFnZVNpemVNQkVycm9yJywge1xuICAgICAgICBtZXNzYWdlOiBgSW52YWxpZCBmdW5jdGlvbiBlcGhlbWVyYWxTdG9yYWdlU2l6ZU1CIG9mICR7dGhpcy5wcm9wcy5lcGhlbWVyYWxTdG9yYWdlU2l6ZU1CfWAsXG4gICAgICAgIHJlc29sdXRpb246IGBlcGhlbWVyYWxTdG9yYWdlU2l6ZU1CIG11c3QgYmUgYSB3aG9sZSBudW1iZXIgYmV0d2VlbiAke2VwaGVtZXJhbFN0b3JhZ2VTaXplTWlufSBhbmQgJHtlcGhlbWVyYWxTdG9yYWdlU2l6ZU1heH0gaW5jbHVzaXZlYCxcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcy5wcm9wcy5lcGhlbWVyYWxTdG9yYWdlU2l6ZU1CO1xuICB9O1xuXG4gIHByaXZhdGUgcmVzb2x2ZUVudmlyb25tZW50ID0gKCkgPT4ge1xuICAgIGlmICh0aGlzLnByb3BzLmVudmlyb25tZW50ID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHJldHVybiB7fTtcbiAgICB9XG5cbiAgICBjb25zdCBpbnZhbGlkS2V5czogc3RyaW5nW10gPSBbXTtcblxuICAgIE9iamVjdC5rZXlzKHRoaXMucHJvcHMuZW52aXJvbm1lbnQpLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgLy8gdmFsaWRhdGUgdXNpbmcga2V5IHBhdHRlcm4gZnJvbSBodHRwczovL2RvY3MuYXdzLmFtYXpvbi5jb20vbGFtYmRhL2xhdGVzdC9hcGkvQVBJX0Vudmlyb25tZW50Lmh0bWxcbiAgICAgIGlmICgha2V5Lm1hdGNoKC9eW2EtekEtWl0oW2EtekEtWjAtOV9dKSskLykpIHtcbiAgICAgICAgaW52YWxpZEtleXMucHVzaChrZXkpO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgaWYgKGludmFsaWRLZXlzLmxlbmd0aCA+IDApIHtcbiAgICAgIHRocm93IG5ldyBBbXBsaWZ5VXNlckVycm9yKCdJbnZhbGlkRW52aXJvbm1lbnRLZXlFcnJvcicsIHtcbiAgICAgICAgbWVzc2FnZTogYEludmFsaWQgZnVuY3Rpb24gZW52aXJvbm1lbnQga2V5KHMpOiAke2ludmFsaWRLZXlzLmpvaW4oXG4gICAgICAgICAgJywgJ1xuICAgICAgICApfWAsXG4gICAgICAgIHJlc29sdXRpb246XG4gICAgICAgICAgJ0Vudmlyb25tZW50IGtleXMgbXVzdCBtYXRjaCBbYS16QS1aXShbYS16QS1aMC05X10pKyBhbmQgYmUgYXQgbGVhc3QgMiBjaGFyYWN0ZXJzJyxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnByb3BzLmVudmlyb25tZW50O1xuICB9O1xuXG4gIHByaXZhdGUgcmVzb2x2ZVJ1bnRpbWUgPSAoKSA9PiB7XG4gICAgY29uc3QgcnVudGltZURlZmF1bHQgPSAxODtcblxuICAgIC8vIGlmIHJ1bnRpbWUgaXMgbm90IHNldCwgZGVmYXVsdCB0byB0aGUgb2xkZXN0IExUU1xuICAgIGlmICghdGhpcy5wcm9wcy5ydW50aW1lKSB7XG4gICAgICByZXR1cm4gcnVudGltZURlZmF1bHQ7XG4gICAgfVxuXG4gICAgaWYgKCEodGhpcy5wcm9wcy5ydW50aW1lIGluIG5vZGVWZXJzaW9uTWFwKSkge1xuICAgICAgdGhyb3cgbmV3IEFtcGxpZnlVc2VyRXJyb3IoJ0ludmFsaWRSdW50aW1lRXJyb3InLCB7XG4gICAgICAgIG1lc3NhZ2U6IGBJbnZhbGlkIGZ1bmN0aW9uIHJ1bnRpbWUgb2YgJHt0aGlzLnByb3BzLnJ1bnRpbWV9YCxcbiAgICAgICAgcmVzb2x1dGlvbjogYHJ1bnRpbWUgbXVzdCBiZSBvbmUgb2YgdGhlIGZvbGxvd2luZzogJHtPYmplY3Qua2V5cyhcbiAgICAgICAgICBub2RlVmVyc2lvbk1hcFxuICAgICAgICApLmpvaW4oJywgJyl9YCxcbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnByb3BzLnJ1bnRpbWU7XG4gIH07XG5cbiAgcHJpdmF0ZSByZXNvbHZlQXJjaGl0ZWN0dXJlID0gKCkgPT4ge1xuICAgIGNvbnN0IGFyY2hpdGVjdHVyZURlZmF1bHQgPSAneDg2XzY0JztcblxuICAgIGlmICghdGhpcy5wcm9wcy5hcmNoaXRlY3R1cmUpIHtcbiAgICAgIHJldHVybiBhcmNoaXRlY3R1cmVEZWZhdWx0O1xuICAgIH1cblxuICAgIGlmICghKHRoaXMucHJvcHMuYXJjaGl0ZWN0dXJlIGluIGFyY2hpdGVjdHVyZU1hcCkpIHtcbiAgICAgIHRocm93IG5ldyBBbXBsaWZ5VXNlckVycm9yKCdJbnZhbGlkQXJjaGl0ZWN0dXJlRXJyb3InLCB7XG4gICAgICAgIG1lc3NhZ2U6IGBJbnZhbGlkIGZ1bmN0aW9uIGFyY2hpdGVjdHVyZSBvZiAke3RoaXMucHJvcHMuYXJjaGl0ZWN0dXJlfWAsXG4gICAgICAgIHJlc29sdXRpb246IGBhcmNoaXRlY3R1cmUgbXVzdCBiZSBvbmUgb2YgdGhlIGZvbGxvd2luZzogJHtPYmplY3Qua2V5cyhcbiAgICAgICAgICBhcmNoaXRlY3R1cmVNYXBcbiAgICAgICAgKS5qb2luKCcsICcpfWAsXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gdGhpcy5wcm9wcy5hcmNoaXRlY3R1cmU7XG4gIH07XG5cbiAgcHJpdmF0ZSByZXNvbHZlU2NoZWR1bGUgPSAoKSA9PiB7XG4gICAgaWYgKCF0aGlzLnByb3BzLnNjaGVkdWxlKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXMucHJvcHMuc2NoZWR1bGU7XG4gIH07XG5cbiAgcHJpdmF0ZSByZXNvbHZlQnVuZGxpbmcgPSAoKSA9PiB7XG4gICAgY29uc3QgYnVuZGxpbmdEZWZhdWx0ID0ge1xuICAgICAgZm9ybWF0OiBPdXRwdXRGb3JtYXQuRVNNLFxuICAgICAgYnVuZGxlQXdzU0RLOiB0cnVlLFxuICAgICAgbG9hZGVyOiB7XG4gICAgICAgICcubm9kZSc6ICdmaWxlJyxcbiAgICAgIH0sXG4gICAgICBtaW5pZnk6IHRydWUsXG4gICAgICBzb3VyY2VNYXA6IHRydWUsXG4gICAgfTtcblxuICAgIHJldHVybiB7XG4gICAgICAuLi5idW5kbGluZ0RlZmF1bHQsXG4gICAgICBtaW5pZnk6IHRoaXMucmVzb2x2ZU1pbmlmeSh0aGlzLnByb3BzLmJ1bmRsaW5nKSxcbiAgICB9O1xuICB9O1xuXG4gIHByaXZhdGUgcmVzb2x2ZU1pbmlmeSA9IChidW5kbGluZz86IEZ1bmN0aW9uQnVuZGxpbmdPcHRpb25zKSA9PiB7XG4gICAgcmV0dXJuIGJ1bmRsaW5nPy5taW5pZnkgPT09IHVuZGVmaW5lZCA/IHRydWUgOiBidW5kbGluZy5taW5pZnk7XG4gIH07XG59XG5cbnR5cGUgSHlkcmF0ZWRGdW5jdGlvblByb3BzID0gUmVxdWlyZWQ8RnVuY3Rpb25Qcm9wcz47XG5cbmNsYXNzIEZ1bmN0aW9uR2VuZXJhdG9yIGltcGxlbWVudHMgQ29uc3RydWN0Q29udGFpbmVyRW50cnlHZW5lcmF0b3Ige1xuICByZWFkb25seSByZXNvdXJjZUdyb3VwTmFtZTogQW1wbGlmeVJlc291cmNlR3JvdXBOYW1lO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcmVhZG9ubHkgcHJvcHM6IEh5ZHJhdGVkRnVuY3Rpb25Qcm9wcyxcbiAgICBwcml2YXRlIHJlYWRvbmx5IG91dHB1dFN0b3JhZ2VTdHJhdGVneTogQmFja2VuZE91dHB1dFN0b3JhZ2VTdHJhdGVneTxGdW5jdGlvbk91dHB1dD5cbiAgKSB7XG4gICAgdGhpcy5yZXNvdXJjZUdyb3VwTmFtZSA9IHByb3BzLnJlc291cmNlR3JvdXBOYW1lO1xuICB9XG5cbiAgZ2VuZXJhdGVDb250YWluZXJFbnRyeSA9ICh7XG4gICAgc2NvcGUsXG4gICAgYmFja2VuZFNlY3JldFJlc29sdmVyLFxuICB9OiBHZW5lcmF0ZUNvbnRhaW5lckVudHJ5UHJvcHMpID0+IHtcbiAgICAvLyBNb3ZlIGxheWVyIHJlc29sdXRpb24gaGVyZSB3aGVyZSB3ZSBoYXZlIGFjY2VzcyB0byBzY29wZVxuICAgIGNvbnN0IHBhcnNlciA9IG5ldyBGdW5jdGlvbkxheWVyQXJuUGFyc2VyKFxuICAgICAgU3RhY2sub2Yoc2NvcGUpLnJlZ2lvbixcbiAgICAgIFN0YWNrLm9mKHNjb3BlKS5hY2NvdW50XG4gICAgKTtcbiAgICBjb25zdCByZXNvbHZlZExheWVyQXJucyA9IHBhcnNlci5wYXJzZUxheWVycyhcbiAgICAgIHRoaXMucHJvcHMubGF5ZXJzID8/IHt9LFxuICAgICAgdGhpcy5wcm9wcy5uYW1lXG4gICAgKTtcblxuICAgIC8vIHJlc29sdmUgbGF5ZXJzIHRvIExheWVyVmVyc2lvbiBvYmplY3RzIGZvciB0aGUgTm9kZWpzRnVuY3Rpb24gY29uc3RydWN0b3JcbiAgICBjb25zdCByZXNvbHZlZExheWVycyA9IE9iamVjdC5lbnRyaWVzKHJlc29sdmVkTGF5ZXJBcm5zKS5tYXAoKFtrZXksIGFybl0pID0+XG4gICAgICBMYXllclZlcnNpb24uZnJvbUxheWVyVmVyc2lvbkFybihcbiAgICAgICAgc2NvcGUsXG4gICAgICAgIGAke3RoaXMucHJvcHMubmFtZX0tJHtrZXl9LWxheWVyYCxcbiAgICAgICAgYXJuXG4gICAgICApXG4gICAgKTtcblxuICAgIHJldHVybiBuZXcgQW1wbGlmeUZ1bmN0aW9uKFxuICAgICAgc2NvcGUsXG4gICAgICB0aGlzLnByb3BzLm5hbWUsXG4gICAgICB7IC4uLnRoaXMucHJvcHMsIHJlc29sdmVkTGF5ZXJzIH0sXG4gICAgICBiYWNrZW5kU2VjcmV0UmVzb2x2ZXIsXG4gICAgICB0aGlzLm91dHB1dFN0b3JhZ2VTdHJhdGVneVxuICAgICk7XG4gIH07XG59XG5cbmNsYXNzIEFtcGxpZnlGdW5jdGlvblxuICBleHRlbmRzIENvbnN0cnVjdFxuICBpbXBsZW1lbnRzXG4gICAgUmVzb3VyY2VQcm92aWRlcjxGdW5jdGlvblJlc291cmNlcz4sXG4gICAgUmVzb3VyY2VBY2Nlc3NBY2NlcHRvckZhY3RvcnksXG4gICAgQWRkRW52aXJvbm1lbnRGYWN0b3J5XG57XG4gIHJlYWRvbmx5IHJlc291cmNlczogRnVuY3Rpb25SZXNvdXJjZXM7XG4gIHJlYWRvbmx5IHN0YWNrOiBTdGFjaztcbiAgcHJpdmF0ZSByZWFkb25seSBmdW5jdGlvbkVudmlyb25tZW50VHJhbnNsYXRvcjogRnVuY3Rpb25FbnZpcm9ubWVudFRyYW5zbGF0b3I7XG4gIGNvbnN0cnVjdG9yKFxuICAgIHNjb3BlOiBDb25zdHJ1Y3QsXG4gICAgaWQ6IHN0cmluZyxcbiAgICBwcm9wczogSHlkcmF0ZWRGdW5jdGlvblByb3BzICYgeyByZXNvbHZlZExheWVyczogSUxheWVyVmVyc2lvbltdIH0sXG4gICAgYmFja2VuZFNlY3JldFJlc29sdmVyOiBCYWNrZW5kU2VjcmV0UmVzb2x2ZXIsXG4gICAgb3V0cHV0U3RvcmFnZVN0cmF0ZWd5OiBCYWNrZW5kT3V0cHV0U3RvcmFnZVN0cmF0ZWd5PEZ1bmN0aW9uT3V0cHV0PlxuICApIHtcbiAgICBzdXBlcihzY29wZSwgaWQpO1xuXG4gICAgdGhpcy5zdGFjayA9IFN0YWNrLm9mKHNjb3BlKTtcblxuICAgIGNvbnN0IHJ1bnRpbWUgPSBub2RlVmVyc2lvbk1hcFtwcm9wcy5ydW50aW1lXTtcblxuICAgIGNvbnN0IHJlcXVpcmUgPSBjcmVhdGVSZXF1aXJlKGltcG9ydC5tZXRhLnVybCk7XG5cbiAgICBjb25zdCBzaGltcyA9XG4gICAgICBydW50aW1lID09PSBSdW50aW1lLk5PREVKU18xNl9YXG4gICAgICAgID8gW11cbiAgICAgICAgOiBbcmVxdWlyZS5yZXNvbHZlKCcuL2xhbWJkYS1zaGltcy9janNfc2hpbScpXTtcblxuICAgIGNvbnN0IHNzbVJlc29sdmVyRmlsZSA9XG4gICAgICBydW50aW1lID09PSBSdW50aW1lLk5PREVKU18xNl9YXG4gICAgICAgID8gcmVxdWlyZS5yZXNvbHZlKCcuL2xhbWJkYS1zaGltcy9yZXNvbHZlX3NzbV9wYXJhbXNfc2RrX3YyJykgLy8gdXNlIGF3cyBjZGsgdjIgaW4gbm9kZSAxNlxuICAgICAgICA6IHJlcXVpcmUucmVzb2x2ZSgnLi9sYW1iZGEtc2hpbXMvcmVzb2x2ZV9zc21fcGFyYW1zJyk7XG5cbiAgICBjb25zdCBpbnZva2VTc21SZXNvbHZlckZpbGUgPSByZXF1aXJlLnJlc29sdmUoXG4gICAgICAnLi9sYW1iZGEtc2hpbXMvaW52b2tlX3NzbV9zaGltJ1xuICAgICk7XG5cbiAgICAvKipcbiAgICAgKiBUaGlzIGNvZGUgY29uY2F0ZW5hdGVzIHRoZSBjb250ZW50cyBvZiB0aGUgc3NtIHJlc29sdmVyIGFuZCBpbnZva2VyIGludG8gYSBzaW5nbGUgbGluZSB0aGF0IGNhbiBiZSB1c2VkIGFzIHRoZSBlc2J1aWxkIGJhbm5lciBjb250ZW50XG4gICAgICogVGhpcyBiYW5uZXIgaXMgcmVzcG9uc2libGUgZm9yIHJlc29sdmluZyB0aGUgY3VzdG9tZXIncyBTU00gcGFyYW1ldGVycyBhdCBydW50aW1lXG4gICAgICovXG4gICAgY29uc3QgYmFubmVyQ29kZSA9IHJlYWRGaWxlU3luYyhzc21SZXNvbHZlckZpbGUsICd1dGYtOCcpXG4gICAgICAuY29uY2F0KHJlYWRGaWxlU3luYyhpbnZva2VTc21SZXNvbHZlckZpbGUsICd1dGYtOCcpKVxuICAgICAgLnNwbGl0KG5ldyBSZWdFeHAoYCR7RU9MfXxcXG58XFxyYCwgJ2cnKSlcbiAgICAgIC5tYXAoKGxpbmUpID0+IGxpbmUucmVwbGFjZSgvXFwvXFwvLiokLywgJycpKSAvLyBzdHJpcCBvdXQgaW5saW5lIGNvbW1lbnRzIGJlY2F1c2UgdGhlIGJhbm5lciBpcyBnb2luZyB0byBiZSBmbGF0dGVuZWQgaW50byBhIHNpbmdsZSBsaW5lXG4gICAgICAuam9pbignJyk7XG5cbiAgICBjb25zdCBmdW5jdGlvbkVudmlyb25tZW50VHlwZUdlbmVyYXRvciA9XG4gICAgICBuZXcgRnVuY3Rpb25FbnZpcm9ubWVudFR5cGVHZW5lcmF0b3IoaWQpO1xuXG4gICAgLy8gZXNidWlsZCBydW5zIGFzIHBhcnQgb2YgdGhlIE5vZGVqc0Z1bmN0aW9uIGNvbnN0cnVjdG9yLCBzbyB3ZSBlYWdlcmx5IGdlbmVyYXRlIHRoZSBwcm9jZXNzIGVudiBzaGltIHdpdGhvdXQgdHlwZXMgc28gaXQgY2FuIGJlIGluY2x1ZGVkIGluIHRoZSBmdW5jdGlvbiBidW5kbGUuXG4gICAgLy8gVGhpcyB3aWxsIGJlIG92ZXJ3cml0dGVuIHdpdGggdGhlIHR5cGVkIGZpbGUgYXQgdGhlIGVuZCBvZiBzeW50aGVzaXNcbiAgICBmdW5jdGlvbkVudmlyb25tZW50VHlwZUdlbmVyYXRvci5nZW5lcmF0ZVByb2Nlc3NFbnZTaGltKCk7XG5cbiAgICBsZXQgZnVuY3Rpb25MYW1iZGE6IE5vZGVqc0Z1bmN0aW9uO1xuICAgIGNvbnN0IGNka0xvZ2dpbmdPcHRpb25zID0gY29udmVydExvZ2dpbmdPcHRpb25zVG9DREsocHJvcHMubG9nZ2luZyk7XG4gICAgdHJ5IHtcbiAgICAgIGZ1bmN0aW9uTGFtYmRhID0gbmV3IE5vZGVqc0Z1bmN0aW9uKHNjb3BlLCBgJHtpZH0tbGFtYmRhYCwge1xuICAgICAgICBlbnRyeTogcHJvcHMuZW50cnksXG4gICAgICAgIHRpbWVvdXQ6IER1cmF0aW9uLnNlY29uZHMocHJvcHMudGltZW91dFNlY29uZHMpLFxuICAgICAgICBtZW1vcnlTaXplOiBwcm9wcy5tZW1vcnlNQixcbiAgICAgICAgYXJjaGl0ZWN0dXJlOiBhcmNoaXRlY3R1cmVNYXBbcHJvcHMuYXJjaGl0ZWN0dXJlXSxcbiAgICAgICAgZXBoZW1lcmFsU3RvcmFnZVNpemU6IFNpemUubWViaWJ5dGVzKHByb3BzLmVwaGVtZXJhbFN0b3JhZ2VTaXplTUIpLFxuICAgICAgICBydW50aW1lOiBub2RlVmVyc2lvbk1hcFtwcm9wcy5ydW50aW1lXSxcbiAgICAgICAgbGF5ZXJzOiBwcm9wcy5yZXNvbHZlZExheWVycyxcbiAgICAgICAgYnVuZGxpbmc6IHtcbiAgICAgICAgICAuLi5wcm9wcy5idW5kbGluZyxcbiAgICAgICAgICBiYW5uZXI6IGJhbm5lckNvZGUsXG4gICAgICAgICAgaW5qZWN0OiBzaGltcyxcbiAgICAgICAgICBleHRlcm5hbE1vZHVsZXM6IE9iamVjdC5rZXlzKHByb3BzLmxheWVycyksXG4gICAgICAgIH0sXG4gICAgICAgIGxvZ1JldGVudGlvbjogY2RrTG9nZ2luZ09wdGlvbnMucmV0ZW50aW9uLFxuICAgICAgICBhcHBsaWNhdGlvbkxvZ0xldmVsVjI6IGNka0xvZ2dpbmdPcHRpb25zLmxldmVsLFxuICAgICAgICBsb2dnaW5nRm9ybWF0OiBjZGtMb2dnaW5nT3B0aW9ucy5mb3JtYXQsXG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgLy8gSWYgdGhlIGVycm9yIGlzIGZyb20gRVMgQnVuZGxlciB3aGljaCBpcyBleGVjdXRlZCBhcyBhIGNoaWxkIHByb2Nlc3MgYnkgQ0RLLFxuICAgICAgLy8gdGhlbiB0aGUgZXJyb3IgZnJvbSBDREsgY29udGFpbnMgdGhlIGNvbW1hbmQgdGhhdCB3YXMgZXhlY3V0ZWQgYWxvbmcgd2l0aCB0aGUgZXhpdCBzdGF0dXMuXG4gICAgICAvLyBXcmFwcGluZyBpdCBoZXJlICB3b3VsZCBjYXVzZSB0aGUgY2RrX2RlcGxveWVyIHRvIHJlLXRocm93IHRoaXMgd3JhcHBlZCBleGNlcHRpb25cbiAgICAgIC8vIGluc3RlYWQgb2Ygc2NyYXBpbmcgdGhlIHN0ZGVyciBmb3IgYWN0dWFsIEVTQnVpbGQgZXJyb3IuXG4gICAgICBpZiAoXG4gICAgICAgIGVycm9yIGluc3RhbmNlb2YgRXJyb3IgJiZcbiAgICAgICAgZXJyb3IubWVzc2FnZS5tYXRjaCgvRmFpbGVkIHRvIGJ1bmRsZSBhc3NldC4qZXhpdGVkIHdpdGggc3RhdHVzLylcbiAgICAgICkge1xuICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgIH1cbiAgICAgIHRocm93IG5ldyBBbXBsaWZ5VXNlckVycm9yKFxuICAgICAgICAnTm9kZUpTRnVuY3Rpb25Db25zdHJ1Y3RJbml0aWFsaXphdGlvbkVycm9yJyxcbiAgICAgICAge1xuICAgICAgICAgIG1lc3NhZ2U6ICdGYWlsZWQgdG8gaW5zdGFudGlhdGUgbm9kZWpzIGZ1bmN0aW9uIGNvbnN0cnVjdCcsXG4gICAgICAgICAgcmVzb2x1dGlvbjpcbiAgICAgICAgICAgICdTZWUgdGhlIHVuZGVybHlpbmcgZXJyb3IgbWVzc2FnZSBmb3IgbW9yZSBkZXRhaWxzLiBVc2UgYC0tZGVidWdgIGZvciBhZGRpdGlvbmFsIGRlYnVnZ2luZyBpbmZvcm1hdGlvbi4nLFxuICAgICAgICB9LFxuICAgICAgICBlcnJvciBhcyBFcnJvclxuICAgICAgKTtcbiAgICB9XG5cbiAgICB0cnkge1xuICAgICAgY29uc3Qgc2NoZWR1bGVzID0gY29udmVydEZ1bmN0aW9uU2NoZWR1bGVzVG9SdWxlU2NoZWR1bGVzKFxuICAgICAgICBmdW5jdGlvbkxhbWJkYSxcbiAgICAgICAgcHJvcHMuc2NoZWR1bGVcbiAgICAgICk7XG4gICAgICBjb25zdCBsYW1iZGFUYXJnZXQgPSBuZXcgdGFyZ2V0cy5MYW1iZGFGdW5jdGlvbihmdW5jdGlvbkxhbWJkYSk7XG5cbiAgICAgIHNjaGVkdWxlcy5mb3JFYWNoKChzY2hlZHVsZSwgaW5kZXgpID0+IHtcbiAgICAgICAgLy8gTGFtYmRhIG5hbWUgd2lsbCBiZSBwcmVwZW5kZWQgdG8gcnVsZSBpZCwgc28gb25seSB1c2luZyBpbmRleCBoZXJlIGZvciB1bmlxdWVuZXNzXG4gICAgICAgIGNvbnN0IHJ1bGUgPSBuZXcgUnVsZShmdW5jdGlvbkxhbWJkYSwgYHNjaGVkdWxlJHtpbmRleH1gLCB7XG4gICAgICAgICAgc2NoZWR1bGUsXG4gICAgICAgIH0pO1xuXG4gICAgICAgIHJ1bGUuYWRkVGFyZ2V0KGxhbWJkYVRhcmdldCk7XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgdGhyb3cgbmV3IEFtcGxpZnlVc2VyRXJyb3IoXG4gICAgICAgICdGdW5jdGlvblNjaGVkdWxlSW5pdGlhbGl6YXRpb25FcnJvcicsXG4gICAgICAgIHtcbiAgICAgICAgICBtZXNzYWdlOiAnRmFpbGVkIHRvIGluc3RhbnRpYXRlIHNjaGVkdWxlIGZvciBub2RlanMgZnVuY3Rpb24nLFxuICAgICAgICAgIHJlc29sdXRpb246ICdTZWUgdGhlIHVuZGVybHlpbmcgZXJyb3IgbWVzc2FnZSBmb3IgbW9yZSBkZXRhaWxzLicsXG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yIGFzIEVycm9yXG4gICAgICApO1xuICAgIH1cblxuICAgIFRhZ3Mub2YoZnVuY3Rpb25MYW1iZGEpLmFkZChUYWdOYW1lLkZSSUVORExZX05BTUUsIGlkKTtcblxuICAgIHRoaXMuZnVuY3Rpb25FbnZpcm9ubWVudFRyYW5zbGF0b3IgPSBuZXcgRnVuY3Rpb25FbnZpcm9ubWVudFRyYW5zbGF0b3IoXG4gICAgICBmdW5jdGlvbkxhbWJkYSxcbiAgICAgIHByb3BzLmVudmlyb25tZW50LFxuICAgICAgYmFja2VuZFNlY3JldFJlc29sdmVyLFxuICAgICAgZnVuY3Rpb25FbnZpcm9ubWVudFR5cGVHZW5lcmF0b3JcbiAgICApO1xuXG4gICAgdGhpcy5yZXNvdXJjZXMgPSB7XG4gICAgICBsYW1iZGE6IGZ1bmN0aW9uTGFtYmRhLFxuICAgICAgY2ZuUmVzb3VyY2VzOiB7XG4gICAgICAgIGNmbkZ1bmN0aW9uOiBmdW5jdGlvbkxhbWJkYS5ub2RlLmZpbmRDaGlsZCgnUmVzb3VyY2UnKSBhcyBDZm5GdW5jdGlvbixcbiAgICAgIH0sXG4gICAgfTtcblxuICAgIHRoaXMuc3RvcmVPdXRwdXQob3V0cHV0U3RvcmFnZVN0cmF0ZWd5KTtcblxuICAgIG5ldyBBdHRyaWJ1dGlvbk1ldGFkYXRhU3RvcmFnZSgpLnN0b3JlQXR0cmlidXRpb25NZXRhZGF0YShcbiAgICAgIFN0YWNrLm9mKHRoaXMpLFxuICAgICAgZnVuY3Rpb25TdGFja1R5cGUsXG4gICAgICBmaWxlVVJMVG9QYXRoKG5ldyBVUkwoJy4uL3BhY2thZ2UuanNvbicsIGltcG9ydC5tZXRhLnVybCkpXG4gICAgKTtcbiAgfVxuXG4gIGFkZEVudmlyb25tZW50ID0gKGtleTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nIHwgQmFja2VuZFNlY3JldCkgPT4ge1xuICAgIHRoaXMuZnVuY3Rpb25FbnZpcm9ubWVudFRyYW5zbGF0b3IuYWRkRW52aXJvbm1lbnRFbnRyeShrZXksIHZhbHVlKTtcbiAgfTtcblxuICBnZXRSZXNvdXJjZUFjY2Vzc0FjY2VwdG9yID0gKCkgPT4gKHtcbiAgICBpZGVudGlmaWVyOiBgJHt0aGlzLm5vZGUuaWR9TGFtYmRhUmVzb3VyY2VBY2Nlc3NBY2NlcHRvcmAsXG4gICAgYWNjZXB0UmVzb3VyY2VBY2Nlc3M6IChcbiAgICAgIHBvbGljeTogUG9saWN5LFxuICAgICAgc3NtRW52aXJvbm1lbnRFbnRyaWVzOiBTc21FbnZpcm9ubWVudEVudHJ5W11cbiAgICApID0+IHtcbiAgICAgIGNvbnN0IHJvbGUgPSB0aGlzLnJlc291cmNlcy5sYW1iZGEucm9sZTtcbiAgICAgIGlmICghcm9sZSkge1xuICAgICAgICAvLyBUaGlzIHNob3VsZCBuZXZlciBoYXBwZW4gc2luY2Ugd2UgYXJlIHVzaW5nIHRoZSBGdW5jdGlvbiBMMiBjb25zdHJ1Y3RcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgICdObyBleGVjdXRpb24gcm9sZSBmb3VuZCB0byBhdHRhY2ggbGFtYmRhIHBlcm1pc3Npb25zIHRvJ1xuICAgICAgICApO1xuICAgICAgfVxuICAgICAgcG9saWN5LmF0dGFjaFRvUm9sZShyb2xlKTtcbiAgICAgIHNzbUVudmlyb25tZW50RW50cmllcy5mb3JFYWNoKCh7IG5hbWUsIHBhdGggfSkgPT4ge1xuICAgICAgICB0aGlzLmZ1bmN0aW9uRW52aXJvbm1lbnRUcmFuc2xhdG9yLmFkZFNzbUVudmlyb25tZW50RW50cnkobmFtZSwgcGF0aCk7XG4gICAgICB9KTtcbiAgICB9LFxuICB9KTtcblxuICAvKipcbiAgICogU3RvcmUgc3RvcmFnZSBvdXRwdXRzIHVzaW5nIHByb3ZpZGVkIHN0cmF0ZWd5XG4gICAqL1xuICBwcml2YXRlIHN0b3JlT3V0cHV0ID0gKFxuICAgIG91dHB1dFN0b3JhZ2VTdHJhdGVneTogQmFja2VuZE91dHB1dFN0b3JhZ2VTdHJhdGVneTxGdW5jdGlvbk91dHB1dD5cbiAgKTogdm9pZCA9PiB7XG4gICAgb3V0cHV0U3RvcmFnZVN0cmF0ZWd5LmFwcGVuZFRvQmFja2VuZE91dHB1dExpc3QoZnVuY3Rpb25PdXRwdXRLZXksIHtcbiAgICAgIHZlcnNpb246ICcxJyxcbiAgICAgIHBheWxvYWQ6IHtcbiAgICAgICAgZGVmaW5lZEZ1bmN0aW9uczogdGhpcy5yZXNvdXJjZXMubGFtYmRhLmZ1bmN0aW9uTmFtZSxcbiAgICAgIH0sXG4gICAgfSk7XG4gIH07XG59XG5cbmNvbnN0IGlzV2hvbGVOdW1iZXJCZXR3ZWVuSW5jbHVzaXZlID0gKFxuICB0ZXN0OiBudW1iZXIsXG4gIG1pbjogbnVtYmVyLFxuICBtYXg6IG51bWJlclxuKSA9PiBtaW4gPD0gdGVzdCAmJiB0ZXN0IDw9IG1heCAmJiB0ZXN0ICUgMSA9PT0gMDtcblxuZXhwb3J0IHR5cGUgTm9kZVZlcnNpb24gPSAxNiB8IDE4IHwgMjAgfCAyMjtcblxuY29uc3Qgbm9kZVZlcnNpb25NYXA6IFJlY29yZDxOb2RlVmVyc2lvbiwgUnVudGltZT4gPSB7XG4gIDE2OiBSdW50aW1lLk5PREVKU18xNl9YLFxuICAxODogUnVudGltZS5OT0RFSlNfMThfWCxcbiAgMjA6IFJ1bnRpbWUuTk9ERUpTXzIwX1gsXG4gIDIyOiBSdW50aW1lLk5PREVKU18yMl9YLFxufTtcblxuZXhwb3J0IHR5cGUgRnVuY3Rpb25BcmNoaXRlY3R1cmUgPSAneDg2XzY0JyB8ICdhcm02NCc7XG5cbmNvbnN0IGFyY2hpdGVjdHVyZU1hcDogUmVjb3JkPEZ1bmN0aW9uQXJjaGl0ZWN0dXJlLCBBcmNoaXRlY3R1cmU+ID0ge1xuICBhcm02NDogQXJjaGl0ZWN0dXJlLkFSTV82NCxcbiAgeDg2XzY0OiBBcmNoaXRlY3R1cmUuWDg2XzY0LFxufTtcbiJdfQ==